<!DOCTYPE html>
<html>
  <head>
    <title>Steady Life</title>
    <link rel="stylesheet" type="text/css" href="/public/style/style.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/createForm.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/mainPageButton.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/header.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/table.css"
    />
  <link rel="stylesheet" type="text/css" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    $( function() {
      $( "#datepicker" ).datepicker({
        dateFormat: "yy-mm-dd",
        onSelect: function () {
          document.getDate.submit();
        },
      });
    } );
  </script>

  </head>
  <body>
    <header class="main-header">
      <div class="header">
        <div class="start-header"></div>
        <div class="main-text-container">
        <h1 id="main-text">Steady Life </br></h1>
        </div>
        <div class="end-header">
        <a href="/auth/logout">
          <button class="logout-btn w-btn w-btn-indigo">Logout</button>
        </a>
        </div>
      </div>

      <div class="date-container">
        <div></div>
        <div class="date-move">
          <div></div>
          <div>
            <button class="change-date" id="yesterday-btn"><</button>
          </div>
          <div>
            <div class="main-page-item">
              <form action="/todo/getDate" method="get" name="getDate">
                <input type="text" id="datepicker" name="date" value="<%= currentDate %>"/>
              </form>  
            </div> 
          </div>
          <div>  
            <button class="change-date" id="nextday-btn">></button>
          </div>
          <div></div>
        </div>
        <div></div>
      </div>
      <!-- <hr> -->
      <!-- <div class="sub-header-logout-btn"> -->

      <!-- </div> -->
    </header>
    <br>
    <div class="sub-header">

      <div class="header-main-btn">
        <button id="todolist-button" class="sub-header-btn focus">
          Todo
        </button>
        <button id="myPage-button" class="sub-header-btn">
          MyPage
        </button>
      </div>
      
    </div>
    <br>
    <section class="container">
      <div class="container-scroll">
        <div class="hidden to-do-create-container">
          <form action="/todo/write" method="post" class="form-box">
            <table class="input-table">
              <tr style="height: 50px">
                <td></td>
                <br />
                <td colspan="3">
                  <select id="todo-category-input" class="input-category" name="category">
                    <option value="Category" disabled selected="selected">Category</option>
                    <option value="Í≥µÎ∂Ä">Í≥µÎ∂Ä</option>
                    <option value="ÎèÖÏÑú">ÎèÖÏÑú</option>
                    <option value="Ïö¥Îèô">Ïö¥Îèô</option>
                    <option value="ÏÇ∞Ï±Ö">ÏÇ∞Ï±Ö</option>
                    <option value="Îç∞Ïù¥Ìä∏">Îç∞Ïù¥Ìä∏</option>
                    <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</option>
                  </select>
                </td>
              </tr>
              <tr style="height: 50px">
                <td></td>
                <td colspan="3">
                  <input
                    id="todo-title-input"
                    class="input-title"
                    type="text"
                    placeholder="Title"
                    name="title"
                  />
                </td>
              </tr>
              <tr style="height: 50px">
                <td></td>
                <td>
                  <input
                    id="todo-start-time-input"
                    class="input-time timepicker"
                    type="time"
                    name="startTime"
                  />
                </td>
                <td>~</td>
                <td>
                  <input
                    id="todo-end-time-input"
                    class="input-time timepicker"
                    type="time"
                    name="endTime"
                  />
                </td>
              </tr>
            </table>
            <br>
            <div class="form-button-container">
              <div></div>
              <button id="create-todo-btn" type="submit" class="w-btn w-btn-indigo">Add</button>
              <button type="button" id="form-close-button" class="w-btn w-btn-indigo">Close</button>
              <div></div>
            </div>
          </form>
        </div>
      
        <% let date = ""; 
        let next_date = "";
      
        const calculateTime = (time) => {
          return time.split(':').reduce((acc, cur, idx) => {
            if (idx === 0) return acc + Number(cur * 60);
            else return acc + Number(cur);
          }, 0);
         };

         const convertMinutesToHours = (min) => {
          const hour =
            String(Math.floor(min / 60)).length === 1
              ? '0' + String(Math.floor(min / 60))
              : String(Math.floor(min / 60));
          const minutes =
            String(min % 60).length === 1 ? '0' + String(min % 60) : String(min % 60);

          return hour + ':' + minutes;
         };

        let studyTime = 0;
        let restTime = 0;

        todoTasks.forEach(ele => {
          if(ele.category === "Í≥µÎ∂Ä" || ele.category === "ÎèÖÏÑú"){
            studyTime += calculateTime(ele.remainingTime);
          } else {
            restTime += calculateTime(ele.remainingTime);
          }
        });

        todoTasks.forEach(tasks => {
          date = tasks.date  %>
        
          <div id="time-article-container" class="hidden">
          <div class="time-article-view">
            <table id="time-article">
              <tr>
                <td>
                  ‚úîÔ∏é Î™©Ìëú ÏãúÍ∞Ñ : 
                </td>
                <td>
                  8ÏãúÍ∞Ñ
                </td>
                <td></td>
              </tr>
              <tr>
                <td>
                  <span>‚úîÔ∏é Í≥µÎ∂Ä ÏãúÍ∞Ñ : </span>
                </td>
                <td>
                  <%= Math.floor(studyTime/60) %>ÏãúÍ∞Ñ <%= studyTime%60 %>Î∂Ñ
                </td>
              </tr>
              
                <% if(calculateTime('08:00')-studyTime > 0) { %>
              <tr>
                <td>
                  ‚úîÔ∏é ÎÇ®ÏùÄ ÏãúÍ∞Ñ :
                </td>
                <td>
                  <span style="color: tomato"><%= Math.floor((calculateTime('08:00')-studyTime)/60) %>ÏãúÍ∞Ñ
                    <%= (calculateTime('08:00')-studyTime)%60 %>Î∂Ñ</span>
                </td>
              <tr>
                <td>
                  ‚úîÔ∏é Ìú¥Ïãù ÏãúÍ∞Ñ :
                </td>
                <td>
                  <%= Math.floor(restTime/60) %>ÏãúÍ∞Ñ <%= restTime%60 %>Î∂Ñ
                </td>
              </tr>
                <% } else { %>
              <tr>
                <td>
                  ‚úîÔ∏é Ìú¥Ïãù ÏãúÍ∞Ñ :
                </td>
                <td>
                  <%= Math.floor(restTime/60) %>ÏãúÍ∞Ñ <%= restTime%60 %>Î∂Ñ
                </td>
              </tr>
                <td colspan="3" style="text-align: center;">
                  <span style="color: tomato;">üî• Today Success üî•</span>
                </td>
              </tr>
                <% } %>
              <tr style="height: 50px;">
                <% let str; %>
                <% if(studyTime < 480) { 
                   const turtleTime = Math.floor(studyTime / 60);
                   str = 'ü™µü™µü™µü™µü™µü™µü™µü™µ'
                   for(let i = 0; i < turtleTime; i++) {
                    str = str.replace('ü™µ', 'üå≥');
                   };

                  } else {
                   str = 'üå≥üê¢üå¥'
                  }
                %>
                  <td colspan="2"><%= str %></td>
              </tr>
            </table>
            <br />
            <button id="time-article-close-button" class="w-btn w-btn-indigo edit-button" style="color: tomato;">Close</button>  
          </div>
        </div>
        <table class="main-table">   
          <tr class="table-tr" onclick="location.href='/todo/edit/<%= tasks._id %>'">
            <td id="table-category">
            <% switch (tasks.category) {
                  case "Í≥µÎ∂Ä": %>
                    üìö            
                    <% break;
                  case "Ïö¥Îèô": %>  
                    üí™üèª       
                <% break;
                  case "ÏÇ∞Ï±Ö": %>
                    üö∂üèª‚Äç‚ôÄÔ∏è           
                <% break;
                  case "ÎèÖÏÑú": %>
                    üìñ           
                <% break;
                  case "Îç∞Ïù¥Ìä∏": %>
                    ‚ù£Ô∏è            
                <% break;
                  default: 
                    break; } %>
            </td>
            <td id="table-title" class="table-title">
              <%= tasks.title %>
            </td>
            <td id="table-time" class="table-time"><%= tasks.startTime %> ~ <%= tasks.endTime %></td>
          
          </tr>
        </table>
        <br />
        <% }); %>
        <button id="statistics" class="w-btn w-btn-indigo">Today</button>
      </div>
      <button id="create-btn" class="create-list-btn w-btn w-btn-indigo">+</button>
    </section>


    <section>
      <br>
      <div class="mypage-container hidden">

        <p>ÏïÑÏßÅ ÎØ∏ÏôÑÏÑ±</p>
        <p>Ï∂îÌõÑ ÏõîÎ≥Ñ Í≥µÎ∂ÄÎüâ ÌÜµÍ≥Ñ ÎßåÎì§Í∏∞ => ÏãúÍ∞ÅÌôî</p>
      </div>
    </section>
    <script type="module" src="/public/js/index.js"></script>
  </body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <title>Steady Life</title>
    <link rel="stylesheet" type="text/css" href="/public/style/style.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/createForm.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/Button.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/header.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/table.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/public/style/calendar.css"
    />
  <link rel="stylesheet" type="text/css" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1" />
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <link rel="stylesheet" href="https://naver.github.io/billboard.js/release/latest/dist/theme/datalab.min.css">
  <script src="https://naver.github.io/billboard.js/release/latest/dist/billboard.pkgd.min.js"></script>
  <script>
    $( function() {
      $( "#datepicker" ).datepicker({
        dateFormat: "yy-mm-dd",
        onSelect: function () {
          document.getDate.submit();
        },
      });
    } );
  </script>
  </head>

  <body>

    <header class="main-header">
      <div class="header">
        <div class="start-header"></div>
        <div class="main-text-container">
        <h1 id="main-text">Steady Life </br></h1>
        </div>
        <div class="end-header">
        <a href="/auth/logout">
          <button id="logout-btn" class="standard-btn w-btn w-btn-indigo">Logout</button>
        </a>
        </div>
      </div>
    </header>
    <br>

    <div class="sub-header">
      <div class="header-main-btn">
        <button id="todolist-button" class="sub-header-btn focus">
          Todo
        </button>
        <button id="myPage-button" class="sub-header-btn" onclick="location.href='/todo/myPage/'">
          MyPage
        </button>
      </div>
    </div>
    <br>
    <div class="date-container">
      <div></div>
      <div class="date-move">
        <div></div>
        <div>
          <button class="change-date" id="yesterday-btn"><</button>
        </div>
        <div>
          <div class="main-page-item">
            <form action="/todo/getDate" method="get" name="getDate">
              <input type="text" id="datepicker" name="date" value="<%= currentDate %>"/>
            </form>  
          </div> 
        </div>
        <div>  
          <button class="change-date" id="nextday-btn">></button>
        </div>
        <div></div>
      </div>
      <div></div>
    </div>
    <br>
    <div class="loader"></div>
    <section class="container hidden">
      <div class="container-scroll">
        <div class="hidden to-do-create-container">
          <form action="/todo/write" method="post" class="form-box">
            <table class="input-table">
              <tr style="height: 50px">
                <td colspan="4">
                  <select id="todo-category-input" class="input-category" name="category">
                    <option value="Category" disabled selected="selected">Category</option>
                    <option value="ê³µë¶€">ê³µë¶€</option>
                    <option value="ë…ì„œ">ë…ì„œ</option>
                    <option value="ìˆ˜ë©´">ìˆ˜ë©´</option>
                    <option value="ìš´ë™">ìš´ë™</option>
                    <option value="ì‚°ì±…">ì‚°ì±…</option>
                    <option value="ë°ì´íŠ¸">ë°ì´íŠ¸</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                  </select>
                </td>
              </tr>
              <tr style="height: 50px">
                <br>
                <td colspan="4">
                  <input
                    id="todo-title-input"
                    class="input-title"
                    type="text"
                    placeholder="Title"
                    name="title"
                  />
                </td>
              </tr>
              <tr style="height: 50px">
                <td colspan="2">
                  <input
                    id="todo-start-time-input"
                    class="input-time timepicker"
                    type="time"
                    name="startTime"
                  />
                </td>
                <td colspan="2">
                  <input
                    id="todo-end-time-input"
                    class="input-time timepicker"
                    type="time"
                    name="endTime"
                  />
                </td>
              </tr>
            </table>
            <br>
            <div class="form-button-container">
              <div></div>
              <button id="create-todo-btn" type="submit" class="w-btn w-btn-indigo standard-btn">Add</button>
              <button type="button" id="form-close-button" class="w-btn w-btn-indigo standard-btn" style="color: tomato;">Close</button>
              <div></div>
            </div>
          </form>
        </div>
        <% 
        const calculateTime = (time) => {
          return time.split(':').reduce((acc, cur, idx) => {
            if (idx === 0) return acc + Number(cur * 60);
            else return acc + Number(cur);
          }, 0);
         };

        const convertMinutesToHours = (min) => {
          const hour =
            String(Math.floor(min / 60)).length === 1
              ? '0' + String(Math.floor(min / 60))
              : String(Math.floor(min / 60));
          const minutes =
            String(min % 60).length === 1 ? '0' + String(min % 60) : String(min % 60);

          return hour + ':' + minutes;
        };

        let studyTime = 0;
        let restTime = 0;

        todoTasks.forEach(ele => {
          if(ele.category === "ê³µë¶€" || ele.category === "ë…ì„œ"){
            studyTime += calculateTime(ele.remainingTime);
          } else {
            restTime += calculateTime(ele.remainingTime);
          }
        });
        
        let [study, exercise, walk, reading, love, sleep, other] = [0, 0, 0, 0, 0, 0, 0];

        todoTasks.forEach(ele => {
          switch (ele.category) {
            case "ê³µë¶€":
              study += calculateTime(ele.remainingTime);
              break;
            case "ë…ì„œ":
              reading += calculateTime(ele.remainingTime);
              break;
            case "ìš´ë™":
              exercise += calculateTime(ele.remainingTime);
              break;  
            case "ì‚°ì±…":
              walk += calculateTime(ele.remainingTime);
              break;
            case "ë°ì´íŠ¸":
              love += calculateTime(ele.remainingTime);
              break;
            case "ìˆ˜ë©´":
              sleep += calculateTime(ele.remainingTime);
            default:
              other += calculateTime(ele.remainingTime);
              break;
          }
        });

        todoTasks.forEach(tasks => {
          let date = tasks.date  %>

        <table class="main-table">
          <tr class="table-tr" onclick="location.href='/todo/edit/<%= tasks._id %>'">

            <td id="table-category">
            <% switch (tasks.category) {
                  case "ê³µë¶€": %>
                    ğŸ“š            
                    <% break;
                  case "ìš´ë™": %>  
                    ğŸ’ªğŸ»       
                <% break;
                  case "ì‚°ì±…": %>
                    ğŸš¶ğŸ»â€â™€ï¸           
                <% break;
                  case "ë…ì„œ": %>
                    ğŸ“–   
                <% break;
                  case "ìˆ˜ë©´": %>
                    ğŸ›Œ          
                <% break;
                  case "ë°ì´íŠ¸": %>
                    â£ï¸            
                <% break;
                  default: 
                    break; } %>
            </td>
            <td id="table-title" class="table-title">
              <%= tasks.title %>
            </td>
            <td id="table-time" class="table-time"><%= tasks.startTime %> ~ <%= tasks.endTime %></td>
          
          </tr>
        </table>
        <br />
        <% }); %>

        <span id="study" class="hidden"><%= study %></span>
        <span id="exercise" class="hidden"><%= exercise %></span> 
        <span id="reading" class="hidden"><%= reading %></span>
        <span id="sleep" class="hidden"><%= sleep %></span> 
        <span id="love" class="hidden"><%= love %></span> 
        <span id="walk" class="hidden"><%= walk %></span>
        <span id="other" class="hidden"><%= other %></span> 
        
        <div class="time-article-container hidden">
          <div class="time-article-view">
            <table id="time-article">
              <th style="width: 120px;">
                Study
              </th>
              <th style="width: 120px;">
                Rest
              </th>
              <tr>
                <td>
                  <%= Math.floor(studyTime/60) %>ì‹œê°„ <%= studyTime%60 %>ë¶„
                </td>
                <td>
                  <%= Math.floor(restTime/60) %>ì‹œê°„ <%= restTime%60 %>ë¶„
                </td>
              </tr>
              <tr style="height: 100px;">

                <% let studyTree = '';
                   let restSprout = '';

                   const totalStudyTime = Math.floor(studyTime / 60);
                   const totalRestTime = Math.floor(restTime / 60);

                   
                   totalStudyTime < 1 ? studyTree="ğŸ" :
                   totalStudyTime <= 2 ? studyTree="ğŸŒ±" :
                   totalStudyTime <= 3 ? studyTree="ğŸŒ¿" :
                   totalStudyTime <= 4 ? studyTree="ğŸ€" :
                   totalStudyTime <= 5 ? studyTree="ğŸª´" :
                   totalStudyTime <= 6 ? studyTree="ğŸŒ²" : studyTree="ğŸŒ³"; 

                   totalRestTime < 1 ? restSprout="ğŸ¥€" :
                   totalRestTime <= 2 ? restSprout="ğŸŒº" :
                   totalRestTime <= 3 ? restSprout="ğŸŒ·" :
                   totalRestTime <= 4 ? restSprout="ğŸŒ¹" :
                   totalRestTime <= 5 ? restSprout="ğŸŒ¸" :
                   totalRestTime <= 6 ? restSprout="ğŸŒ¼" : restSprout="ğŸŒ»"; %>
                  <td> 
                    <span style="font-size: 70px;"><%= studyTree %></span><br />
                    <% if(studyTime >= 360) { %>
                    <span style="font-size: 25px;">ğŸ’¯</span>
                    <% } %> 
                 </td>
                  <td>
                    <span style="font-size: 70px;"><%= restSprout %></span>
                    <% if(restTime >= 360) { %>
                      <br /><span style="font-size: 25px;">ğŸ’¯</span>
                    <% } %> 
                  </td>  
              </tr>
            </table>
            <br />
            <div id="time-article-button">
              <div></div>
              <div></div>
              <div>
                <button id="time-article-close-button" class="w-btn w-btn-indigo standard-btn" style="color: tomato;">Close</button>
              </div>
              <div></div>
              <div>
                <button id="time-article-help-button" class="w-btn w-btn-indigo">?</button>  
              </div>
            </div>
          </div>
        </div>

        <div id="help-container" class="hidden">
          <div class="help-view">
            <span id="help-title">Every Hour</span>
            <br />
            <br />
            <table>
              <tr style="height: 50px;">
                <td> ğŸ </td>
                <td> ğŸŒ± </td>
                <td> ğŸŒ¿ </td>
                <td> ğŸ€ </td>
                <td> ğŸª´ </td>
                <td> ğŸŒ² </td>
                <td> ğŸŒ³ </td>
              </tr>
              <tr>
                <td>ğŸ¥€</td>
                <td>ğŸŒº</td>
                <td>ğŸŒ·</td>
                <td>ğŸŒ¹</td>
                <td>ğŸŒ¸</td>
                <td>ğŸŒ¼</td>
                <td>ğŸŒ»</td>
              </tr>
            </table>
            <br />

            <div class="help-btn-container">
              <div></div>
              <div></div>
              <div></div>
              <div>
                <button id="help-close-btn" class="w-btn w-btn-indigo small-standard-btn" style="color:tomato">x</button>
              </div>
            </div>

          </div>
        </div>
        <button id="statistics" class="w-btn w-btn-indigo small-standard-btn">Today</button>
      </div>
      <button id="create-btn" class="w-btn w-btn-indigo small-standard-btn">+</button>
    </section>
    <br />
    <br />
    <br />
    <br />
    <footer>
      <p>
        <a onclick="Swal.fire('pmhxxhsj@gmail.com')">Email</a> &nbsp;|&nbsp; 
        <a href='https://parkparkpark.tistory.com/' target='_blank'>Blog</a>&nbsp;|&nbsp; 
        <a href='https://github.com/pmhxhsj' target='_blank'>Github</a>
        <br/>
        <span>Copyright 2022. Wony. All Rights Reserved.</span>
      </p>
    </footer>
    <script type="module" src="/public/js/index.js"></script>
    <script src="/public/js/changeDate.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script>
      $(window).load(function(){
        $(".loader").fadeOut();
        document.querySelector('.container').classList.remove('hidden');
      });  
    </script>
  </body>
</html>